# 									高并发的秒杀系统

# 1.背景

秒杀作为一种常用促销手段，在电商行业广泛使用，特别是每年的618，双11，众多厂家推出层出不穷的玩法。秒杀业务会让系统瞬时出现极高的并发量，同时秒杀的活动规则的也是花样百出，如果与业务深度耦合，就不能使用市场的快速发展。



# 2.需求设计



- 满足秒杀业务的高并发需求
- 具备耦合性低，高可用、维护性高的通用性秒杀系统



# 3.总体方案

![image-20210128005440547](C:\Users\Johar\AppData\Roaming\Typora\typora-user-images\image-20210128005440547.png)



由于秒杀业务本身的高并发特性，为了减少秒杀活动前几分钟对平台的压力，可以将秒杀商品页面的静态资源推送到CDN服务器，用户请求由CDN直接响应，不必达到后端服务器。

参与秒杀活动的商品一般数量较少，只能有少量用户可以抢购。因此在负载均衡层，通过应用防火墙进行流量控制，当下单请求超过阈值后，熔断下单接口。

对于被应用防火墙放行的请求，落到web服务器，进行处理。考虑到下单主要是写操作，数据库性能抗不住，活动前将商品预热分配到KV集群上，KV数据定时同步到DB中。



# 4.方案分解

## 4.1 客户端

- 专门为商品生成商品页面和订单页面，这些页面以静态HTML为主，包括的动态信息尽量少
- “下单”按钮为动态的JS文件
- JS和HTML同时缓存在CDN上面，用户从离自己最近的CDN服务器上面下载这些信息
- 客户端为了避免程序参与秒杀，客户端上面设计问答或者滑块功能，减少机器人对业务的影响



## 4.2 代理层设计

- 缓存，由于用户信息变化较少，可以将用户信息缓存在代理层
- 负载均衡，系统支持横向拓展，使用负载均衡的技术，分摊系统压力
- 拦截，通过分控系统拦截频繁访问的ip请求
- 限流，每个服务器集群有自己的能力限制，超过设计阈值，则拒绝后续请求
- 动态管理，支持平台统一动态调整管理代理层的配置参数



## 4.3 秒杀业务





## 4.4 数据库



## 4.5 DevOps





# 5.修订记录



| 序号 | 时间      | 修改人 | 修改内容 |
| ---- | --------- | ------ | -------- |
| 1    | 2021-1-27 | Johar  | 创建     |
|      |           |        |          |
|      |           |        |          |
|      |           |        |          |
|      |           |        |          |
|      |           |        |          |
|      |           |        |          |
|      |           |        |          |
|      |           |        |          |



















